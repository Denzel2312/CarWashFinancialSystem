<Page x:Class="CarWashFinancialSystem.Views.Pages.UsersPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Пользователи"
      Background="#121212">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="Управление пользователями" 
                       Foreground="White" FontSize="20" FontWeight="Bold"/>
            <TextBlock Text="Добавление и редактирование сотрудников автомойки" 
                       Foreground="#B3B3B3" FontSize="14" Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Quick Stats -->
        <Border Grid.Row="1" Background="#1E1E1E" Padding="15" Margin="0,0,0,20" CornerRadius="8">
            <StackPanel Orientation="Horizontal">
                <Border Background="#2D2D2D" Padding="15" Margin="0,0,15,0" CornerRadius="6" Width="180">
                    <StackPanel>
                        <TextBlock Text="Всего пользователей" Foreground="#B3B3B3" FontSize="12"/>
                        <TextBlock x:Name="TotalUsersText" Text="0" Foreground="#2196F3" FontSize="18" FontWeight="Bold"/>
                    </StackPanel>
                </Border>

                <Border Background="#2D2D2D" Padding="15" Margin="0,0,15,0" CornerRadius="6" Width="180">
                    <StackPanel>
                        <TextBlock Text="Администраторы" Foreground="#B3B3B3" FontSize="12"/>
                        <TextBlock x:Name="AdminsText" Text="0" Foreground="#7E57C2" FontSize="18" FontWeight="Bold"/>
                    </StackPanel>
                </Border>

                <Border Background="#2D2D2D" Padding="15" Margin="0,0,15,0" CornerRadius="6" Width="180">
                    <StackPanel>
                        <TextBlock Text="Менеджеры" Foreground="#B3B3B3" FontSize="12"/>
                        <TextBlock x:Name="ManagersText" Text="0" Foreground="#FF9800" FontSize="18" FontWeight="Bold"/>
                    </StackPanel>
                </Border>

                <Border Background="#2D2D2D" Padding="15" Margin="0,0,15,0" CornerRadius="6" Width="180">
                    <StackPanel>
                        <TextBlock Text="Операторы" Foreground="#B3B3B3" FontSize="12"/>
                        <TextBlock x:Name="OperatorsText" Text="0" Foreground="#4CAF50" FontSize="18" FontWeight="Bold"/>
                    </StackPanel>
                </Border>

                <Button Content="➕ Новый пользователь" 
                        Background="#7E57C2" Foreground="Black" Padding="15,10" FontWeight="Bold"
                        Click="AddUserButton_Click"/>
            </StackPanel>
        </Border>

        <!-- Users List -->
        <Border Grid.Row="2" Background="#1E1E1E" Padding="20" CornerRadius="8">
            <StackPanel>
                <TextBlock Text="Список пользователей" Foreground="White" FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="400">
                    <ListView x:Name="UsersListView" 
                              Background="Transparent" Foreground="White" BorderThickness="0">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="ID" Width="50" DisplayMemberBinding="{Binding Id}"/>
                                <GridViewColumn Header="Логин" Width="120" DisplayMemberBinding="{Binding Username}"/>
                                <GridViewColumn Header="ФИО" Width="200" DisplayMemberBinding="{Binding FullName}"/>
                                <GridViewColumn Header="Роль" Width="120" DisplayMemberBinding="{Binding Role}"/>
                                <GridViewColumn Header="Дата регистрации" Width="120" DisplayMemberBinding="{Binding CreatedAt, StringFormat={}{0:dd.MM.yyyy}}"/>
                                <GridViewColumn Header="Статус" Width="100">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding IsActive, Converter={StaticResource BoolToStatusConverter}}"
                                                       Foreground="{Binding IsActive, Converter={StaticResource BoolToColorConverter}}"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Действия" Width="200">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Button Content="✏️" Tag="{Binding Id}" Click="EditUserButton_Click" 
                                                        Background="Transparent" BorderThickness="0" Foreground="#7E57C2"
                                                        ToolTip="Редактировать"/>
                                                <Button Content="🔑" Tag="{Binding Id}" Click="ChangePasswordButton_Click" 
                                                        Background="Transparent" BorderThickness="0" Foreground="#FFC107" Margin="5,0,0,0"
                                                        ToolTip="Сменить пароль"/>
                                                <Button Content="❌" Tag="{Binding Id}" Click="DeleteUserButton_Click" 
                                                        Background="Transparent" BorderThickness="0" Foreground="#FF5252" Margin="5,0,0,0"
                                                        ToolTip="Деактивировать"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </ScrollViewer>
            </StackPanel>
        </Border>
    </Grid>
</Page>