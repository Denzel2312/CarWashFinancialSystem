<Page x:Class="CarWashFinancialSystem.Views.Pages.ReportsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:system="clr-namespace:System;assembly=mscorlib"
      Title="Отчёты"
      Background="#121212">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="Финансовые отчёты" 
                       Foreground="White" FontSize="20" FontWeight="Bold"/>
            <TextBlock Text="Аналитика доходов, расходов и прибыли" 
                       Foreground="#B3B3B3" FontSize="14" Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Period Selection -->
        <Border Grid.Row="1" Background="#1E1E1E" Padding="20" Margin="0,0,0,20" CornerRadius="8">
            <StackPanel>
                <TextBlock Text="Период отчёта" Foreground="White" FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="200"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="200"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="С:" Foreground="#B3B3B3" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <DatePicker Grid.Column="1" x:Name="StartDatePicker" 
                                SelectedDate="{x:Static system:DateTime.Now}" 
                                Background="#2D2D2D" Foreground="Black" BorderBrush="#404040"/>

                    <TextBlock Grid.Column="2" Text="По:" Foreground="#B3B3B3" VerticalAlignment="Center" Margin="20,0,10,0"/>
                    <DatePicker Grid.Column="3" x:Name="EndDatePicker" 
                                SelectedDate="{x:Static system:DateTime.Now}" 
                                Background="#2D2D2D" Foreground="Black" BorderBrush="#404040"/>

                    <StackPanel Grid.Column="5" Orientation="Horizontal" Margin="20,0,0,0">
                        <Button Content="📊 Сформировать" 
                                Background="#7E57C2" Foreground="Black" Padding="15,10" FontWeight="Bold"
                                Click="GenerateReport_Click"/>
                        <Menu Grid.Column="5" VerticalAlignment="Center" Margin="20,0,0,0" Background="Transparent">
                            <Menu.Items>
                                <MenuItem Header="📊 Экспорт отчета" Background="#7E57C2" Foreground="Black">
                                    <MenuItem Header="📋 Полный отчет" Click="ExportFullReport_Click"/>
                                    <MenuItem Header="💳 Только транзакции" Click="ExportTransactions_Click"/>
                                    <MenuItem Header="💰 Только расходы" Click="ExportExpenses_Click"/>
                                    <MenuItem Header="📈 Только аналитика" Click="ExportSummary_Click"/>
                                </MenuItem>
                            </Menu.Items>
                        </Menu>
                    </StackPanel>
                </Grid>

                <!-- Quick Period Buttons -->
                <StackPanel Orientation="Horizontal" Margin="0,15,0,0">
                    <Button Content="Сегодня" Background="Transparent" Foreground="#B3B3B3" Padding="10,5"
                            Click="TodayButton_Click"/>
                    <Button Content="Неделя" Background="Transparent" Foreground="#B3B3B3" Padding="10,5" Margin="10,0,0,0"
                            Click="WeekButton_Click"/>
                    <Button Content="Месяц" Background="Transparent" Foreground="#B3B3B3" Padding="10,5" Margin="10,0,0,0"
                            Click="MonthButton_Click"/>
                    <Button Content="Квартал" Background="Transparent" Foreground="#B3B3B3" Padding="10,5" Margin="10,0,0,0"
                            Click="QuarterButton_Click"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Report Content -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- Financial Summary -->
                <Border Background="#1E1E1E" Padding="20" Margin="0,0,0,15" CornerRadius="8">
                    <StackPanel>
                        <TextBlock Text="Финансовая сводка" Foreground="White" FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Background="#2D2D2D" Padding="15" Margin="5" CornerRadius="6">
                                <StackPanel>
                                    <TextBlock Text="Выручка" Foreground="#B3B3B3" FontSize="12"/>
                                    <TextBlock x:Name="RevenueText" Text="0 руб" Foreground="#4CAF50" FontSize="18" FontWeight="Bold"/>
                                </StackPanel>
                            </Border>

                            <Border Grid.Column="1" Background="#2D2D2D" Padding="15" Margin="5" CornerRadius="6">
                                <StackPanel>
                                    <TextBlock Text="Расходы" Foreground="#B3B3B3" FontSize="12"/>
                                    <TextBlock x:Name="ExpensesText" Text="0 руб" Foreground="#F44336" FontSize="18" FontWeight="Bold"/>
                                </StackPanel>
                            </Border>

                            <Border Grid.Column="2" Background="#2D2D2D" Padding="15" Margin="5" CornerRadius="6">
                                <StackPanel>
                                    <TextBlock Text="Прибыль" Foreground="#B3B3B3" FontSize="12"/>
                                    <TextBlock x:Name="ProfitText" Text="0 руб" Foreground="#FF9800" FontSize="18" FontWeight="Bold"/>
                                </StackPanel>
                            </Border>

                            <Border Grid.Column="3" Background="#2D2D2D" Padding="15" Margin="5" CornerRadius="6">
                                <StackPanel>
                                    <TextBlock Text="Операций" Foreground="#B3B3B3" FontSize="12"/>
                                    <TextBlock x:Name="TransactionsText" Text="0" Foreground="#2196F3" FontSize="18" FontWeight="Bold"/>
                                </StackPanel>
                            </Border>

                            <Border Grid.Column="4" Background="#2D2D2D" Padding="15" Margin="5" CornerRadius="6">
                                <StackPanel>
                                    <TextBlock Text="Средний чек" Foreground="#B3B3B3" FontSize="12"/>
                                    <TextBlock x:Name="AvgCheckText" Text="0 руб" Foreground="#9C27B0" FontSize="18" FontWeight="Bold"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Popular Services -->
                <Border Background="#1E1E1E" Padding="20" Margin="0,0,0,15" CornerRadius="8">
                    <StackPanel>
                        <TextBlock Text="Популярные услуги" Foreground="White" FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                        <ListView x:Name="PopularServicesListView" 
                                  Background="Transparent" Foreground="White" BorderThickness="0"
                                  Height="200">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Услуга" Width="200" DisplayMemberBinding="{Binding ServiceName}"/>
                                    <GridViewColumn Header="Количество" Width="100" DisplayMemberBinding="{Binding Count}"/>
                                    <GridViewColumn Header="Сумма" Width="120" DisplayMemberBinding="{Binding TotalAmount, StringFormat={}{0} руб}"/>
                                    <GridViewColumn Header="Доля" Width="100" DisplayMemberBinding="{Binding Percentage, StringFormat={}{0:F1}%}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </StackPanel>
                </Border>

                <!-- Daily Report -->
                <Border Background="#1E1E1E" Padding="20" CornerRadius="8">
                    <StackPanel>
                        <TextBlock Text="Отчёт по дням" Foreground="White" FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                        <ListView x:Name="DailyReportListView" 
                                  Background="Transparent" Foreground="White" BorderThickness="0"
                                  Height="300">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Дата" Width="100" DisplayMemberBinding="{Binding Date, StringFormat={}{0:dd.MM.yy}}"/>
                                    <GridViewColumn Header="Выручка" Width="100" DisplayMemberBinding="{Binding Revenue, StringFormat={}{0} руб}"/>
                                    <GridViewColumn Header="Расходы" Width="100" DisplayMemberBinding="{Binding Expenses, StringFormat={}{0} руб}"/>
                                    <GridViewColumn Header="Прибыль" Width="100" DisplayMemberBinding="{Binding Profit, StringFormat={}{0} руб}"/>
                                    <GridViewColumn Header="Операций" Width="80" DisplayMemberBinding="{Binding TransactionsCount}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>